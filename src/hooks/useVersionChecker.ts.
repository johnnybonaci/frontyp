import { useEffect, useState } from 'react'

export function useVersionChecker(intervalMs = 60000) {
    const [updateAvailable, setUpdateAvailable] = useState(false)
    const [currentVersion, setCurrentVersion] = useState(null)

    useEffect(() => {
        const checkVersion = async () => {
            try {
                const res = await fetch('/version.txt', { cache: 'no-store' })
                const version = await res.text()

                if (!currentVersion) {
                    setCurrentVersion(version)
                } else if (version !== currentVersion) {
                    setUpdateAvailable(true)
                }
            } catch (err) {
                console.error("Error al verificar la versiÃ³n:", err)
            }
        }

        checkVersion()
        const interval = setInterval(checkVersion, intervalMs)

        return () => clearInterval(interval)
    }, [currentVersion, intervalMs])

    return { updateAvailable, refreshApp: () => window.location.reload() }
}
